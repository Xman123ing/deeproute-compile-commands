# DeepRoute Compile Commands

ä¸€ä¸ªä¸“ä¸º DeepRoute é¡¹ç›®ä¼˜åŒ–çš„ Cursor/VS Code æ‰©å±•ï¼Œ**åœ¨ Docker å®¹å™¨å†…**æ‰§è¡Œç¼–è¯‘å‘½ä»¤å¹¶å®æ—¶ç›‘æ§è¾“å‡ºï¼Œè‡ªåŠ¨ç®¡ç† `compile_commands.json` å’Œ clangd è¯­è¨€æœåŠ¡å™¨ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- ğŸ³ **Docker å¼ºåˆ¶æ¨¡å¼** - æ‰€æœ‰å‘½ä»¤åœ¨ Docker å®¹å™¨å†…æ‰§è¡Œï¼Œç¡®ä¿ç¯å¢ƒä¸€è‡´æ€§
- ğŸ”„ **Clangd è‡ªåŠ¨ç®¡ç†** - æ£€æµ‹åˆ° `compile_commands.json` æ›´æ–°åè‡ªåŠ¨å¤„ç†è·¯å¾„å¹¶é‡å¯ clangd
- ğŸ“Š **æ™ºèƒ½è·¯å¾„æ›¿æ¢** - è‡ªåŠ¨å°†å®¹å™¨è·¯å¾„ `/sandbox` æ›¿æ¢ä¸ºå®¿ä¸»æœºè·¯å¾„
- ğŸ¯ **å¯è§†åŒ– TreeView** - æ ‘å½¢è§†å›¾ç•Œé¢ï¼Œå¿«é€Ÿæ‰§è¡Œé¢„è®¾å‘½ä»¤å’ŒæŸ¥çœ‹å†å²
- âš¡ **å®æ—¶è¾“å‡ºç›‘æ§** - å‘½ä»¤è¾“å‡ºå®æ—¶æ˜¾ç¤ºï¼Œæ”¯æŒ ANSI é¢œè‰²è¿‡æ»¤
- ğŸ“ **å‘½ä»¤å†å²æŒä¹…åŒ–** - æ‰§è¡Œå†å²è‡ªåŠ¨ä¿å­˜ï¼Œæ”¯æŒå¿«é€Ÿé‡å¤æ‰§è¡Œ
- ğŸ”§ **é¢„è®¾å‘½ä»¤ç®¡ç†** - æ”¯æŒå‘½ä»¤åˆ«åå’Œè‡ªå®šä¹‰å·¥ä½œç›®å½•

## åŠŸèƒ½åˆ—è¡¨

- âœ… **Docker å®¹å™¨å¼ºåˆ¶æ¨¡å¼** - é»˜è®¤å®¹å™¨ `deeproute-dev-x86-2004`
- âœ… **è‡ªåŠ¨å®¹å™¨ç®¡ç†** - è‡ªåŠ¨æ£€æµ‹å¹¶å¯åŠ¨ Docker å®¹å™¨
- âœ… **è·¯å¾„æ™ºèƒ½æ›¿æ¢** - `/sandbox` è·¯å¾„è‡ªåŠ¨æ˜ å°„åˆ°å®¿ä¸»æœº
- âœ… **Clangd è‡ªåŠ¨é‡å¯** - `compile_commands.json` æ›´æ–°åè‡ªåŠ¨å¤„ç†
- âœ… **TreeView å¯è§†åŒ–ç•Œé¢** - ç±»ä¼¼ OUTLINE çš„æ ‘å½¢è§†å›¾
- âœ… **é¢„è®¾å‘½ä»¤åˆ«å** - å¯ä¸ºé•¿å‘½ä»¤è®¾ç½®ç®€çŸ­åˆ«å
- âœ… **è‡ªå®šä¹‰å·¥ä½œç›®å½•** - æ”¯æŒç›¸å¯¹è·¯å¾„ `cwd` é…ç½®
- âœ… **å‘½ä»¤æ‰§è¡Œå†å²** - æŒä¹…åŒ–ä¿å­˜ï¼Œå¿«é€Ÿé‡å¤æ‰§è¡Œ
- âœ… **å®æ—¶è¾“å‡ºè¿‡æ»¤** - ANSI è½¬ä¹‰ç è‡ªåŠ¨æ¸…ç†
- âœ… **è¿›åº¦æç¤º** - å‘½ä»¤æ‰§è¡ŒçŠ¶æ€å®æ—¶åé¦ˆ
- âœ… **å¿«æ·æ“ä½œ** - å³é”®èœå•å’Œå·¥å…·æ æŒ‰é’®

## å®‰è£…æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä»VSIXæ–‡ä»¶å®‰è£…ï¼ˆæ¨èï¼‰

1. åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ‰“åŒ…æ‰©å±•ï¼š
```bash
cd deeproute-compile-commands
npm install
npm run compile
npx vsce package
```

2. åœ¨Cursorä¸­å®‰è£…ï¼š
   - æ‰“å¼€Cursor
   - æŒ‰ `Cmd+Shift+P` (Mac) æˆ– `Ctrl+Shift+P` (Windows/Linux)
   - è¾“å…¥ "Install from VSIX"
   - é€‰æ‹©ç”Ÿæˆçš„ `.vsix` æ–‡ä»¶

### æ–¹æ³•äºŒï¼šå¼€å‘æ¨¡å¼

1. å…‹éš†æˆ–å¤åˆ¶æ’ä»¶ç›®å½•åˆ°æœ¬åœ°
2. åœ¨æ’ä»¶ç›®å½•æ‰§è¡Œï¼š
```bash
npm install
npm run compile
```

3. åœ¨Cursorä¸­ï¼š
   - æŒ‰ `F5` é”®å¯åŠ¨è°ƒè¯•
   - æˆ–æ‰“å¼€æ’ä»¶ç›®å½•ï¼ŒæŒ‰ `Cmd+Shift+D` è¿›å…¥è°ƒè¯•è§†å›¾ï¼Œç‚¹å‡»è¿è¡Œ

## ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èä½¿ç”¨TreeViewï¼‰

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯è§†åŒ–TreeViewä¾§è¾¹æ ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€DeepRoute Compile Commandsä¾§è¾¹æ **ï¼š
   - ç‚¹å‡»å·¦ä¾§æ´»åŠ¨æ çš„ Terminal å›¾æ ‡ï¼ˆDeepRoute Compile Commandsï¼‰
   - ä¼šæ˜¾ç¤ºä¸€ä¸ªæ ‘å½¢è§†å›¾é¢æ¿

2. **æ‰§è¡Œé¢„è®¾å‘½ä»¤**ï¼š
   - åœ¨"ğŸ“‹ é¢„è®¾å‘½ä»¤"èŠ‚ç‚¹ä¸‹ï¼Œç›´æ¥**ç‚¹å‡»å‘½ä»¤**å³å¯æ‰§è¡Œ
   - å‘½ä»¤æ—è¾¹çš„æ’­æ”¾æŒ‰é’®ä¹Ÿå¯ä»¥ç‚¹å‡»æ‰§è¡Œ

3. **æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤**ï¼š
   - ç‚¹å‡»"â• æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤"èŠ‚ç‚¹
   - è¾“å…¥è¦æ‰§è¡Œçš„å‘½ä»¤

4. **æŸ¥çœ‹å†å²è®°å½•**ï¼š
   - å±•å¼€"ğŸ•’ å‘½ä»¤å†å²"èŠ‚ç‚¹
   - ç‚¹å‡»å†å²å‘½ä»¤å¯ä»¥å†æ¬¡æ‰§è¡Œ

5. **å·¥å…·æ æ“ä½œ**ï¼š
   - ğŸ”„ åˆ·æ–°å‘½ä»¤åˆ—è¡¨
   - â¹ï¸ åœæ­¢å½“å‰å‘½ä»¤
   - ğŸ—‘ï¸ æ¸…ç©ºè¾“å‡º
   - ğŸ—‘ï¸ æ¸…ç©ºå†å²è®°å½•
   - â• æ·»åŠ é¢„è®¾å‘½ä»¤

6. **å³é”®èœå•**ï¼š
   - å³é”®ç‚¹å‡»é¢„è®¾å‘½ä»¤ï¼šæ‰§è¡Œæˆ–ç§»é™¤
   - å³é”®ç‚¹å‡»å†å²å‘½ä»¤ï¼šé‡æ–°æ‰§è¡Œ

#### æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤é¢æ¿

1. **æ‰§è¡Œé¢„è®¾å‘½ä»¤**ï¼š
   - æŒ‰ `Cmd+Shift+P` (Mac) æˆ– `Ctrl+Shift+P` (Windows/Linux)
   - è¾“å…¥ "DeepRoute Compile Commands: æ‰§è¡Œé¢„è®¾å‘½ä»¤"
   - ä»åˆ—è¡¨ä¸­é€‰æ‹©è¦æ‰§è¡Œçš„å‘½ä»¤

2. **æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤**ï¼š
   - æŒ‰ `Cmd+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
   - è¾“å…¥ "DeepRoute Compile Commands: æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤"
   - è¾“å…¥è¦æ‰§è¡Œçš„shellå‘½ä»¤

3. **åœæ­¢å‘½ä»¤**ï¼š
   - æŒ‰ `Cmd+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
   - è¾“å…¥ "DeepRoute Compile Commands: åœæ­¢å½“å‰å‘½ä»¤"
   - æˆ–åœ¨æ‰§è¡Œè¿›åº¦é€šçŸ¥ä¸­ç‚¹å‡»å–æ¶ˆæŒ‰é’®

4. **æ¸…ç©ºè¾“å‡º**ï¼š
   - æŒ‰ `Cmd+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
   - è¾“å…¥ "DeepRoute Compile Commands: æ¸…ç©ºè¾“å‡º"

### é…ç½®é€‰é¡¹

åœ¨ Cursor è®¾ç½®ä¸­æœç´¢ "DeepRoute Compile Commands" å¯ä»¥é…ç½®ä»¥ä¸‹é€‰é¡¹ï¼š

#### Docker å®¹å™¨åç§°ï¼ˆå¿…éœ€ï¼‰

æŒ‡å®š Docker å®¹å™¨åç§°ï¼Œé»˜è®¤å€¼ä¸º `deeproute-dev-x86-2004`ï¼š

```json
{
  "deeproute-compile-commands.dockerContainerName": "deeproute-dev-x86-2004"
}
```

**é…ç½®æ–¹å¼**ï¼š
- **æ–¹æ³• 1**ï¼šé€šè¿‡å‘½ä»¤é¢æ¿ â†’ "DeepRoute Compile Commands: Configure Docker Container"
- **æ–¹æ³• 2**ï¼šåœ¨è®¾ç½® UI ä¸­æœç´¢ `dockerContainerName`
- **æ–¹æ³• 3**ï¼šç›´æ¥ç¼–è¾‘ `settings.json`

> âš ï¸ **é‡è¦**ï¼šæ‰€æœ‰å‘½ä»¤éƒ½åœ¨ Docker å®¹å™¨å†…æ‰§è¡Œï¼Œå¦‚éœ€æ›´æ”¹å®¹å™¨ï¼Œè¯·ä¿®æ”¹æ­¤é…ç½®ã€‚

#### é¢„è®¾å‘½ä»¤åˆ—è¡¨

é…ç½®å¸¸ç”¨çš„ç¼–è¯‘å‘½ä»¤ï¼Œæ”¯æŒå­—ç¬¦ä¸²æ ¼å¼å’Œå¯¹è±¡æ ¼å¼ï¼š

**ç®€å•æ ¼å¼**ï¼š
```json
{
  "deeproute-compile-commands.predefinedCommands": [
    "pwd",
    "ls -la"
  ]
}
```

**é«˜çº§æ ¼å¼ï¼ˆæ¨èï¼‰**ï¼š
```json
{
  "deeproute-compile-commands.predefinedCommands": [
    {
      "command": "ARCH_VERSION=x86_2004 CORE_NUMS=12 VEHICLE_ID=C01-PT pipeline/package.sh",
      "alias": "build-x86_2004-C01-PT",
      "cwd": "blc"
    },
    {
      "command": "ARCH_VERSION=x86_2004 CORE_NUMS=12 pipeline/package.sh -w -t refresh_c01_compile_commands",
      "alias": "compile-commands-x86_2004-C01-PT",
      "cwd": "blc"
    }
  ]
}
```

**å­—æ®µè¯´æ˜**ï¼š
- `command`ï¼šå®é™…æ‰§è¡Œçš„å‘½ä»¤
- `alias`ï¼šæ˜¾ç¤ºåœ¨ UI ä¸Šçš„åˆ«åï¼ˆå¯é€‰ï¼‰
- `cwd`ï¼šå·¥ä½œç›®å½•ï¼Œç›¸å¯¹äº `/sandbox`ï¼ˆå¯é€‰ï¼‰

#### è‡ªå®šä¹‰ Shellï¼ˆå®¹å™¨å†…ï¼‰

æŒ‡å®šå®¹å™¨å†…ä½¿ç”¨çš„ shellï¼ˆé»˜è®¤ `/bin/bash`ï¼‰ï¼š

```json
{
  "deeproute-compile-commands.shell": "/bin/bash"
}
```

#### ç¯å¢ƒå˜é‡ï¼ˆå®¹å™¨å†…ï¼‰

ä¸ºå‘½ä»¤æ‰§è¡Œè®¾ç½®é¢å¤–çš„ç¯å¢ƒå˜é‡ï¼š

```json
{
  "deeproute-compile-commands.env": {
    "ARCH_VERSION": "x86_2004",
    "CORE_NUMS": "12"
  }
}
```

## å·¥ä½œåŸç†

### Docker å®¹å™¨æ‰§è¡Œæµç¨‹

1. **å®¹å™¨çŠ¶æ€æ£€æŸ¥**
   - ä½¿ç”¨ `docker inspect` æ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨å’Œè¿è¡ŒçŠ¶æ€
   - å¦‚å®¹å™¨æœªè¿è¡Œï¼Œè‡ªåŠ¨æ‰§è¡Œ `docker start` å¯åŠ¨å®¹å™¨
   - å¯åŠ¨åéªŒè¯å®¹å™¨çŠ¶æ€ï¼Œç¡®ä¿æˆåŠŸè¿è¡Œ

2. **å‘½ä»¤æ‰§è¡Œ**
   - ä½¿ç”¨ `docker exec -i -w /sandbox -u $(id -u):$(id -g)` æ‰§è¡Œå‘½ä»¤
   - è‡ªåŠ¨ä½¿ç”¨å½“å‰ç”¨æˆ·çš„ UID:GIDï¼Œé¿å…æƒé™é—®é¢˜
   - å·¥ä½œç›®å½•é»˜è®¤ä¸º `/sandbox`ï¼Œæ”¯æŒç›¸å¯¹è·¯å¾„ `cwd` é…ç½®

3. **è¾“å‡ºå¤„ç†**
   - å®æ—¶æ•è· stdout å’Œ stderr
   - è‡ªåŠ¨è¿‡æ»¤ ANSI è½¬ä¹‰ç ï¼ˆé¢œè‰²ã€å…‰æ ‡æ§åˆ¶ç­‰ï¼‰
   - åœ¨è¾“å‡ºé¢æ¿æ˜¾ç¤ºæ¸…æ™°çš„å‘½ä»¤æ‰§è¡Œç»“æœ

4. **Clangd é›†æˆ**
   - æ£€æµ‹ `compile_commands.json` æ–‡ä»¶æ›´æ–°
   - ä½¿ç”¨ `sed` æ›¿æ¢å®¹å™¨è·¯å¾„ `/sandbox` ä¸ºå®¿ä¸»æœºè·¯å¾„
   - è‡ªåŠ¨æ‰§è¡Œ `clangd.restart` é‡å¯è¯­è¨€æœåŠ¡å™¨
   - ç¡®ä¿ C++ ä»£ç è¡¥å…¨å’Œè·³è½¬åŠŸèƒ½æ­£å¸¸

### å·¥ä½œåŒºæ£€æŸ¥

æ’ä»¶å¯åŠ¨æ—¶ä¼šéªŒè¯ï¼š
- å½“å‰å·¥ä½œåŒºæ ¹ç›®å½•å¿…é¡»ä¸º `$HOME/codetree/repo`
- å¦‚ç›®å½•ä¸ç¬¦åˆè¦æ±‚ï¼Œæ‰€æœ‰å‘½ä»¤æ‰§è¡Œå°†è¢«é˜»æ­¢

## è¾“å‡ºæ ¼å¼

æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œè¾“å‡ºé¢æ¿ä¼šæ˜¾ç¤ºï¼š

```
========================================
Executing: pwd
ğŸ³ Docker Mode: Yes
ğŸ“¦ Container: deeproute-dev-x86-2004
ğŸ“ Working Dir: /sandbox/blc
Time: 2026-01-20 10:30:00
========================================

/sandbox/blc

----------------------------------------
Command executed successfully (exit code: 0)
----------------------------------------
```

**å¦‚æœ `compile_commands.json` æ›´æ–°**ï¼š
```
[Clangd] compile_commands.json has been updated
[Clangd] Replacing /sandbox paths with /home/pinli/codetree/repo...
[Clangd] Successfully replaced 1247 lines in 3.24s
[Clangd] Restarting clangd language server...
âœ… Clangd restarted successfully
ğŸ’¡ Check the status bar (bottom-right) for clangd status
```

## å¼€å‘ä¸è´¡çŒ®

### é¡¹ç›®ç»“æ„

```
deeproute-compile-commands/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ extension.ts       # ä¸»æ‰©å±•æ–‡ä»¶
â”‚   â”œâ”€â”€ deepRouteCompileCommands.ts   # Shellæ‰§è¡Œå™¨
â”‚   â””â”€â”€ outputManager.ts   # è¾“å‡ºç®¡ç†å™¨
â”œâ”€â”€ package.json           # æ‰©å±•é…ç½®
â”œâ”€â”€ tsconfig.json          # TypeScripté…ç½®
â””â”€â”€ README.md             # æ–‡æ¡£
```

### å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘
npm run compile

# ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨ç¼–è¯‘
npm run watch

# ä»£ç æ£€æŸ¥
npm run lint

# æ‰“åŒ…
npx vsce package
```

## å¸¸è§é—®é¢˜

### Q: Docker å®¹å™¨æœªé…ç½®æ€ä¹ˆåŠï¼Ÿ

A: æ’ä»¶ä¼šæ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼š
- é€šè¿‡å‘½ä»¤é¢æ¿æ‰§è¡Œ "DeepRoute Compile Commands: Configure Docker Container"
- æˆ–åœ¨è®¾ç½®ä¸­é…ç½® `deeproute-compile-commands.dockerContainerName`
- é»˜è®¤å€¼ä¸º `deeproute-dev-x86-2004`

### Q: Docker å®¹å™¨æœªè¿è¡Œæ€ä¹ˆåŠï¼Ÿ

A: æ’ä»¶ä¼šè‡ªåŠ¨å¤„ç†ï¼š
- è‡ªåŠ¨æ£€æµ‹å®¹å™¨çŠ¶æ€
- å¦‚å®¹å™¨æœªè¿è¡Œï¼Œè‡ªåŠ¨æ‰§è¡Œ `docker start`
- éªŒè¯å®¹å™¨å¯åŠ¨æˆåŠŸ
- å¦‚å¯åŠ¨å¤±è´¥ï¼Œæ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯å’Œå»ºè®®

### Q: `compile_commands.json` è·¯å¾„æ›¿æ¢å¤±è´¥ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- ç¡®ä¿æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆå®¹å™¨å†…ç”Ÿæˆï¼Œå®¿ä¸»æœºå¯è¯»å†™ï¼‰
- æŸ¥çœ‹è¾“å‡ºé¢æ¿çš„ `[Clangd]` æ—¥å¿—
- ç¡®è®¤ `sed` å‘½ä»¤æ‰§è¡ŒæˆåŠŸï¼ˆä¼šæ˜¾ç¤ºæ›¿æ¢è¡Œæ•°ï¼‰
- æ–‡ä»¶è¿‡å¤§æ—¶æ›¿æ¢å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ

### Q: å·¥ä½œåŒºæ ¹ç›®å½•ä¸ç¬¦åˆè¦æ±‚ï¼Ÿ

A: æ’ä»¶è¦æ±‚å·¥ä½œåŒºæ ¹ç›®å½•ä¸º `$HOME/codetree/repo`ï¼š
- ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•æ‰“å¼€ Cursor
- ä¸è¦æ‰“å¼€å­ç›®å½•æˆ–çˆ¶ç›®å½•
- é”™è¯¯æ—¶æ’ä»¶ä¼šé˜»æ­¢å‘½ä»¤æ‰§è¡Œå¹¶æ˜¾ç¤ºæç¤º

### Q: å¦‚ä½•æ·»åŠ å¿«æ·é”®ï¼Ÿ

A: åœ¨ Cursor çš„ `keybindings.json` ä¸­æ·»åŠ ï¼š

```json
{
  "key": "cmd+shift+e",
  "command": "deeproute-compile-commands.executeCommand"
},
{
  "key": "cmd+shift+t",
  "command": "deeproute-compile-commands.executeCustomCommand"
}
```

### Q: Clangd é‡å¯åä»æ— æ³•è·³è½¬ï¼Ÿ

A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æŸ¥çœ‹ VS Code çŠ¶æ€æ å³ä¸‹è§’çš„ clangd çŠ¶æ€
- ç¡®è®¤ `compile_commands.json` è·¯å¾„æ›¿æ¢æˆåŠŸ
- å°è¯•æ‰‹åŠ¨æ‰§è¡Œ "clangd: Restart language server"
- æŸ¥çœ‹ "clangd" è¾“å‡ºé¢æ¿ï¼ˆä¸æ˜¯ "DeepRoute Compile Commands"ï¼‰

## è®¸å¯è¯

MIT
