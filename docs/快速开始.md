# DeepRoute Compile Commands - å¿«é€Ÿå¼€å§‹æŒ‡å—

> ğŸ³ **ä¸“ä¸º DeepRoute é¡¹ç›®ä¼˜åŒ–**ï¼šDocker å¼ºåˆ¶æ¨¡å¼ + Clangd è‡ªåŠ¨ç®¡ç† + æ™ºèƒ½è·¯å¾„æ›¿æ¢

## ğŸš€ å®‰è£…æ­¥éª¤

### 1. å®‰è£…ä¾èµ–å¹¶ç¼–è¯‘

åœ¨æ’ä»¶ç›®å½•ä¸­æ‰§è¡Œï¼š

```bash
cd /Users/pinli/Workshop/template-assembler/deeproute-compile-commands
npm install
npm run compile
```

### 2. åœ¨Cursorä¸­åŠ è½½æ’ä»¶

**æ–¹æ³•Aï¼šè°ƒè¯•æ¨¡å¼ï¼ˆæ¨èç”¨äºå¼€å‘æµ‹è¯•ï¼‰**

1. åœ¨Cursorä¸­æ‰“å¼€æ’ä»¶ç›®å½•
2. æŒ‰ `F5` é”®ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„Cursorçª—å£
3. æ–°çª—å£ä¸­æ’ä»¶å·²è‡ªåŠ¨åŠ è½½

**æ–¹æ³•Bï¼šæ‰“åŒ…å®‰è£…ï¼ˆæ¨èç”¨äºæ—¥å¸¸ä½¿ç”¨ï¼‰**

```bash
# å®‰è£…æ‰“åŒ…å·¥å…·
npm install -g @vscode/vsce

# æ‰“åŒ…æ‰©å±•
npx vsce package

# ä¼šç”Ÿæˆ deeproute-compile-commands-1.0.0.vsix æ–‡ä»¶
```

ç„¶ååœ¨Cursorä¸­ï¼š
- æŒ‰ `Cmd+Shift+P` (Mac) æˆ– `Ctrl+Shift+P` (Windows/Linux)
- è¾“å…¥ "Extensions: Install from VSIX"
- é€‰æ‹©ç”Ÿæˆçš„ `.vsix` æ–‡ä»¶

## âš¡ å¿«é€Ÿé…ç½®ï¼ˆå¿…éœ€ï¼‰

### ç¬¬ä¸€æ­¥ï¼šç¡®è®¤ Docker å’Œå®¹å™¨

```bash
# æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œ
docker info

# æ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨
docker ps -a | grep deeproute-dev-x86-2004
```

### ç¬¬äºŒæ­¥ï¼šé…ç½®å®¹å™¨åç§°ï¼ˆå¯é€‰ï¼‰

æ’ä»¶é»˜è®¤ä½¿ç”¨ `deeproute-dev-x86-2004` å®¹å™¨ã€‚å¦‚éœ€æ›´æ”¹ï¼š

**æ–¹æ³•ä¸€ï¼šé€šè¿‡å‘½ä»¤é¢æ¿ï¼ˆæ¨èï¼‰**
1. æŒ‰ `Cmd+Shift+P`
2. è¾“å…¥ "DeepRoute Compile Commands: Configure Docker Container"
3. è¾“å…¥å®¹å™¨åç§°

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘è®¾ç½®**

æ‰“å¼€ Cursor è®¾ç½®ï¼ˆ`Cmd+,` æˆ– `Ctrl+,`ï¼‰ï¼Œæœç´¢ `deeproute-compile-commands`ï¼š

```json
{
  "deeproute-compile-commands.dockerContainerName": "your-container-name"
}
```

> ğŸ’¡ **è¯´æ˜**ï¼š
> - é»˜è®¤å®¹å™¨åç§°ï¼š`deeproute-dev-x86-2004`
> - å®¹å™¨æœªè¿è¡Œæ—¶ä¼šè‡ªåŠ¨å¯åŠ¨
> - æ‰€æœ‰å‘½ä»¤å¼ºåˆ¶åœ¨å®¹å™¨å†…æ‰§è¡Œ

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯é…ç½®

ä½¿ç”¨æ’ä»¶æ‰§è¡Œ `pwd` å‘½ä»¤ï¼Œåº”è¯¥è¾“å‡º `/sandbox`ï¼ˆå®¹å™¨å†…è·¯å¾„ï¼‰ã€‚

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šä½¿ç”¨TreeViewæ‰§è¡Œé¢„è®¾å‘½ä»¤ï¼ˆæ¨èï¼‰â­

1. ç‚¹å‡»å·¦ä¾§æ´»åŠ¨æ çš„Terminalå›¾æ ‡ï¼ˆDeepRoute Compile Commandsï¼‰
2. åœ¨æ ‘å½¢è§†å›¾ä¸­å±•å¼€"ğŸ“‹ é¢„è®¾å‘½ä»¤"
3. **ç›´æ¥ç‚¹å‡»**è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚ `npm install`
4. è¾“å‡ºé¢æ¿ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ‰§è¡Œç»“æœ

**æç¤º**ï¼šè¿™æ˜¯æœ€å¿«çš„æ–¹å¼ï¼Œåªéœ€2æ­¥ï¼

### ç¤ºä¾‹2ï¼šä½¿ç”¨TreeViewæ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤â­

1. åœ¨DeepRoute Compile Commandsä¾§è¾¹æ ä¸­
2. ç‚¹å‡»"â• æ‰§è¡Œè‡ªå®šä¹‰å‘½ä»¤"
3. è¾“å…¥å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š`docker ps`
4. æŸ¥çœ‹è¾“å‡ºé¢æ¿çš„ç»“æœ

### ç¤ºä¾‹3ï¼šä½¿ç”¨å‘½ä»¤å†å²

1. æ‰§è¡Œè¿‡çš„å‘½ä»¤ä¼šè‡ªåŠ¨ä¿å­˜åˆ°"ğŸ•’ å‘½ä»¤å†å²"
2. å±•å¼€å†å²è®°å½•
3. ç‚¹å‡»ä»»ä½•å†å²å‘½ä»¤å¯å†æ¬¡æ‰§è¡Œ
4. æ— éœ€é‡å¤è¾“å…¥é•¿å‘½ä»¤

### ç¤ºä¾‹4ï¼šç®¡ç†é¢„è®¾å‘½ä»¤

**æ·»åŠ å‘½ä»¤**ï¼š
1. ç‚¹å‡»TreeViewå·¥å…·æ çš„"..."æŒ‰é’®
2. é€‰æ‹©"æ·»åŠ é¢„è®¾å‘½ä»¤"
3. è¾“å…¥ï¼š`npm run dev`
4. å‘½ä»¤ç«‹å³å‡ºç°åœ¨é¢„è®¾åˆ—è¡¨ä¸­

**ç§»é™¤å‘½ä»¤**ï¼š
1. å³é”®ç‚¹å‡»é¢„è®¾å‘½ä»¤
2. é€‰æ‹©"ç§»é™¤å‘½ä»¤"
3. ç¡®è®¤ç§»é™¤

### ç¤ºä¾‹5ï¼šä½¿ç”¨å‘½ä»¤é¢æ¿ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

1. æŒ‰ `Cmd+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
2. è¾“å…¥ `DeepRoute Compile Commands: æ‰§è¡Œé¢„è®¾å‘½ä»¤`
3. é€‰æ‹© `npm install` æˆ–å…¶ä»–å‘½ä»¤
4. è¾“å‡ºé¢æ¿ä¼šè‡ªåŠ¨æ˜¾ç¤ºæ‰§è¡Œç»“æœ

### ç¤ºä¾‹5ï¼šé…ç½®å¸¸ç”¨å‘½ä»¤

åœ¨ Cursor è®¾ç½®ä¸­æ·»åŠ ä½ çš„å¸¸ç”¨å‘½ä»¤ï¼š

1. æŒ‰ `Cmd+,` æ‰“å¼€è®¾ç½®
2. æœç´¢ "deeproute-compile-commands"
3. ç¼–è¾‘ "Predefined Commands"ï¼š

**åŸºç¡€é…ç½®ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰**ï¼š
```json
{
  "deeproute-compile-commands.predefinedCommands": [
    "pwd",
    "ls -la"
  ]
}
```

**é«˜çº§é…ç½®ï¼ˆå¯¹è±¡æ ¼å¼ï¼Œæ¨èï¼‰**ï¼š
```json
{
  "deeproute-compile-commands.predefinedCommands": [
    {
      "command": "ARCH_VERSION=x86_2004 CORE_NUMS=12 VEHICLE_ID=C01-PT pipeline/package.sh",
      "alias": "build-x86_2004-C01-PT",
      "cwd": "blc"
    },
    {
      "command": "ARCH_VERSION=x86_2004 CORE_NUMS=12 pipeline/package.sh -w -t refresh_c01_compile_commands",
      "alias": "compile-commands-x86_2004-C01-PT",
      "cwd": "blc"
    }
  ]
}
```

> ğŸ’¡ **å­—æ®µè¯´æ˜**ï¼š
> - `command`ï¼šå®é™…æ‰§è¡Œçš„å‘½ä»¤
> - `alias`ï¼ˆå¯é€‰ï¼‰ï¼šæ˜¾ç¤ºåœ¨ UI ä¸Šçš„åˆ«åï¼Œè®©å‘½ä»¤åˆ—è¡¨æ›´æ¸…æ™°
> - `cwd`ï¼ˆå¯é€‰ï¼‰ï¼šå·¥ä½œç›®å½•ï¼Œç›¸å¯¹äº `/sandbox`ï¼ˆå®¹å™¨å†…è·¯å¾„ï¼‰

## ğŸ› ï¸ é«˜çº§é…ç½®

### Docker å®¹å™¨é…ç½®

æ’ä»¶é»˜è®¤ä½¿ç”¨ `deeproute-dev-x86-2004` å®¹å™¨ã€‚å¦‚éœ€æ›´æ”¹ï¼š

**æ–¹å¼ä¸€ï¼šä½¿ç”¨å‘½ä»¤é¢æ¿ï¼ˆæ¨èï¼‰**

1. æŒ‰ `Cmd+Shift+P` æ‰“å¼€å‘½ä»¤é¢æ¿
2. è¾“å…¥ "DeepRoute Compile Commands: Configure Docker Container"
3. è¾“å…¥å®¹å™¨åç§°

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨ç¼–è¾‘è®¾ç½®**

```json
{
  "deeproute-compile-commands.dockerContainerName": "your-container-name"
}
```

**Docker è‡ªåŠ¨ç®¡ç†**ï¼š
- âœ… å®¹å™¨å­˜åœ¨æ€§è‡ªåŠ¨æ£€æŸ¥
- âœ… å®¹å™¨æœªè¿è¡Œæ—¶è‡ªåŠ¨å¯åŠ¨
- âœ… å¯åŠ¨å¤±è´¥æ—¶è¯¦ç»†é”™è¯¯æç¤º
- âœ… å®¹å™¨å†…å·¥ä½œç›®å½•ï¼š`/sandbox`
- âœ… ä½¿ç”¨å½“å‰ç”¨æˆ· UID:GID æ‰§è¡Œ

### è‡ªå®šä¹‰ Shellï¼ˆå®¹å™¨å†…ï¼‰

æŒ‡å®šå®¹å™¨å†…ä½¿ç”¨çš„ shellï¼š

```json
{
  "deeproute-compile-commands.shell": "/bin/bash"
}
```

### ç¯å¢ƒå˜é‡ï¼ˆå®¹å™¨å†…ï¼‰

ä¸ºå‘½ä»¤æ‰§è¡Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```json
{
  "deeproute-compile-commands.env": {
    "ARCH_VERSION": "x86_2004",
    "CORE_NUMS": "12",
    "VEHICLE_ID": "C01-PT"
  }
}
```

## ğŸ’¡ å®ç”¨æŠ€å·§

### æŠ€å·§1ï¼šæ·»åŠ é”®ç›˜å¿«æ·é”®

åœ¨ `keybindings.json` ä¸­æ·»åŠ ï¼š

```json
{
  "key": "cmd+shift+r",
  "command": "deeproute-compile-commands.executeCommand",
  "when": "editorFocus"
},
{
  "key": "cmd+shift+t",
  "command": "deeproute-compile-commands.executeCustomCommand",
  "when": "editorFocus"
}
```

### æŠ€å·§2ï¼šåœæ­¢é•¿æ—¶é—´è¿è¡Œçš„å‘½ä»¤

- æ–¹æ³•1ï¼šåœ¨æ‰§è¡Œé€šçŸ¥ä¸­ç‚¹å‡»"å–æ¶ˆ"æŒ‰é’®
- æ–¹æ³•2ï¼šæŒ‰ `Cmd+Shift+P`ï¼Œè¾“å…¥ `DeepRoute Compile Commands: åœæ­¢å½“å‰å‘½ä»¤`

### æŠ€å·§3ï¼šæ¸…ç©ºè¾“å‡ºå†å²

æŒ‰ `Cmd+Shift+P`ï¼Œè¾“å…¥ `DeepRoute Compile Commands: æ¸…ç©ºè¾“å‡º`

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šDocker å®¹å™¨æœªé…ç½®

**é”™è¯¯æç¤º**ï¼š
```
âŒ Docker Container Not Configured
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- é€šè¿‡å‘½ä»¤é¢æ¿é…ç½®ï¼š`DeepRoute Compile Commands: Configure Docker Container`
- æˆ–åœ¨è®¾ç½®ä¸­è®¾ç½® `dockerContainerName`
- é»˜è®¤å€¼ä¸º `deeproute-dev-x86-2004`

### é—®é¢˜2ï¼šDocker å®ˆæŠ¤è¿›ç¨‹æœªè¿è¡Œ

**é”™è¯¯æç¤º**ï¼š
```
âŒ Docker is not accessible
ğŸ’¡ Please ensure Docker Desktop/Engine is running.
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å¯åŠ¨ Docker Desktopï¼ˆMac/Windowsï¼‰
# æˆ–å¯åŠ¨ Docker Engineï¼ˆLinuxï¼‰
sudo systemctl start docker
```

### é—®é¢˜3ï¼šå®¹å™¨ä¸å­˜åœ¨

**é”™è¯¯æç¤º**ï¼š
```
âŒ Container 'xxx' does not exist
ğŸ’¡ Available containers:
   container1
   container2
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥å®¹å™¨åç§°é…ç½®æ˜¯å¦æ­£ç¡®
- ä½¿ç”¨ `docker ps -a` æŸ¥çœ‹å¯ç”¨å®¹å™¨
- æ›´æ–°é…ç½®ä¸ºæ­£ç¡®çš„å®¹å™¨åç§°

### é—®é¢˜4ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥

**é”™è¯¯æç¤º**ï¼š
```
âŒ Container started but not running (may have crashed)
ğŸ’¡ Check container logs: docker logs xxx
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs deeproute-dev-x86-2004

# å°è¯•æ‰‹åŠ¨å¯åŠ¨
docker start deeproute-dev-x86-2004

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker inspect deeproute-dev-x86-2004
```

### é—®é¢˜5ï¼šå·¥ä½œåŒºæ ¹ç›®å½•ä¸ç¬¦åˆè¦æ±‚

**é”™è¯¯æç¤º**ï¼š
```
[Error] Workspace root does not meet requirements
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿åœ¨ `$HOME/codetree/repo` ç›®å½•æ‰“å¼€ Cursor
- ä¸è¦æ‰“å¼€å­ç›®å½•æˆ–çˆ¶ç›®å½•

### é—®é¢˜6ï¼šClangd è·¯å¾„æ›¿æ¢å¤±è´¥

**æ£€æŸ¥é¡¹**ï¼š
- âœ… æŸ¥çœ‹è¾“å‡ºé¢æ¿çš„ `[Clangd]` æ—¥å¿—
- âœ… ç¡®è®¤ `compile_commands.json` æ–‡ä»¶æƒé™æ­£ç¡®
- âœ… æ£€æŸ¥ `sed` å‘½ä»¤æ˜¯å¦æˆåŠŸæ‰§è¡Œ
- âœ… å¤§æ–‡ä»¶æ›¿æ¢å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ

## ğŸ“š å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹

### DeepRoute ç¼–è¯‘å‘½ä»¤

```bash
# æŸ¥çœ‹å½“å‰ç›®å½•ï¼ˆéªŒè¯å®¹å™¨ï¼‰
pwd

# å®Œæ•´ç¼–è¯‘
ARCH_VERSION=x86_2004 CORE_NUMS=12 VEHICLE_ID=C01-PT pipeline/package.sh

# ç”Ÿæˆ compile_commands.json
ARCH_VERSION=x86_2004 CORE_NUMS=12 pipeline/package.sh -w -t refresh_c01_compile_commands

# å¢é‡ç¼–è¯‘
bazel build //blc/...

# è¿è¡Œæµ‹è¯•
bazel test //blc/... --test_output=all
```

### å®¹å™¨ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker logs deeproute-dev-x86-2004

# è¿›å…¥å®¹å™¨ï¼ˆè°ƒè¯•ç”¨ï¼‰
docker exec -it deeproute-dev-x86-2004 /bin/bash
```

### æ–‡ä»¶æ“ä½œ

```bash
# æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
ls -la

# æœç´¢æ–‡ä»¶
find . -name "*.cpp"

# æŸ¥çœ‹æ–‡ä»¶å†…å®¹
cat compile_commands.json | head -n 20
```

## ğŸ¨ è¾“å‡ºé¢æ¿è¯´æ˜

**æ ‡å‡†è¾“å‡ºæ ¼å¼**ï¼š

```
========================================
Executing: pwd
ğŸ³ Docker Mode: Yes
ğŸ“¦ Container: deeproute-dev-x86-2004
ğŸ“ Working Dir: /sandbox/blc
Time: 2026-01-20 10:30:00
========================================

/sandbox/blc

----------------------------------------
Command executed successfully (exit code: 0)
----------------------------------------
```

**Clangd è‡ªåŠ¨å¤„ç†**ï¼š

```
[Clangd] compile_commands.json has been updated
[Clangd] Replacing /sandbox paths with /home/pinli/codetree/repo...
[Clangd] Successfully replaced 1247 lines in 3.24s
[Clangd] Restarting clangd language server...
âœ… Clangd restarted successfully
ğŸ’¡ Check the status bar (bottom-right) for clangd status
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **é¢„è®¾å¸¸ç”¨ç¼–è¯‘å‘½ä»¤**
   - ä¸ºé•¿å‘½ä»¤è®¾ç½®ç®€çŸ­åˆ«å
   - ä½¿ç”¨ `cwd` æŒ‡å®šå·¥ä½œç›®å½•

2. **åˆ©ç”¨å‘½ä»¤å†å²**
   - å†å²å‘½ä»¤è‡ªåŠ¨ä¿å­˜
   - å¿«é€Ÿé‡å¤æ‰§è¡Œï¼Œæ— éœ€é‡æ–°è¾“å…¥

3. **å…³æ³¨ Clangd çŠ¶æ€**
   - æŸ¥çœ‹çŠ¶æ€æ å³ä¸‹è§’ clangd å›¾æ ‡
   - `compile_commands.json` æ›´æ–°åç­‰å¾… clangd ç´¢å¼•å®Œæˆ

4. **ä½¿ç”¨ TreeView ç•Œé¢**
   - æ¯”å‘½ä»¤é¢æ¿æ›´å¿«æ·
   - å¯è§†åŒ–ç®¡ç†å‘½ä»¤

5. **æ£€æŸ¥ Docker çŠ¶æ€**
   - ç¡®ä¿å®¹å™¨æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹è¾“å‡ºé¢æ¿äº†è§£å®¹å™¨çŠ¶æ€

ç¥ä½¿ç”¨æ„‰å¿«ï¼ ğŸ‰
